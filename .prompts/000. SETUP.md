# System

You are an expert in DevOps, Google Cloud. A software architect that if famous for not overengineering things, using KISS and cell-architectures as your preferred concepts

# Context

We are bootstrapping a Firebase-based labs, which should be your playground to deploying to the open world your new experiments on resilient, scalable, fault-tolerant systems. Eg: finance, e-commerce and supers apps (Uber-like, Netflix-like, Airbnb-like)


# Task

Generate a monorepo structure that will allow me to:

* Deploy things to *-nonprod and *-prod from a main branch (trunk-based development)
* Change the applications behavior in non-prod and prod from a Feature Flag server (Firebase Remote Config)
* Application and its features/packages should be deployed to non-prod and prod using Github Actions
* Run things locally with a single command with high parity to prod server
* Have a backend sample service based on Express + Typescript; one Firebase Function v2 per "API" / per "domain"
* Have the possibility to trigger a "notification function" from Firestore-based event
* Have the possibility to stream events written to Firestore to a Pub/Sub topic
* Have the possibility to have an in-memory cache, like Redis, hosted on GCP and close to the functions
* Have a sample CQRS example
* Have a demo frontend (based on latest Next.js) that connects to the sample backend service
* The monorepo should support the owner adding "new" use cases to the backend (eg: new domains, new features) incrementally and with isolation, meaning that packaging by feature can be the way to go. This first use case should be called "cqrs-demo"
* "cqrs-demo" should be fully tested using Jest as an integration test suite (hitting either non-prod or prod, depending on the test command parameter)
* inside the packages folder, we should see: "common", "frontend", "backend/health", "backend/cqrs-demo", etc
* Firestore triggers and Pubsub notification should be defined within each "backend" domain... eg: "backend/cqrs-demo" should have its notification function and its event streaming to pubsub. Each "backend" inner folder should be as self-contained as possible. Loosely coupled to the rest of the repo.

Please output the final project tree and a plan to actually implement all that, incrementally and tutorial like. No code snippets needed, just a structured Table of Contents. I will be prompting you for please implementing each step of the tutorial as per my needs.

1. Setup the minimal necessary things manually on Firebase and GitHub
2. Setup the Github repo so that we can deploy something very minimum to Firebase to validate multi-env deployment and trunk-based support using Remote Config: suggestion => Express + typescript app wrapped into a Cloud Function v2, returning a different response to a GET /health endpoint per env
3. Create a second package/feature for the CQRS demo, and then let's incrementally add support for Firestore, Messaging, Firestore Triggers, Pubsub and then Redis on GCP